
 #####AUTOMATION SCRIPT######

  away_mode:
    sequence:
    - service: media_player.play_media
      data:
        entity_id: media_player.entre_speaker
        media_content_id: !secret content_silence_mp3
        media_content_type: music
    - delay: '00:00:03'
    - service: tts.google_say
      entity_id: media_player.entre_speaker
      data:
        message: 'Gästläge aktiverat!'
      
  home_mode:
    sequence:
    - service: automation.trigger
      data: 
        entity_id: automation.home_mode
    - service: media_player.play_media
      data:
        entity_id: media_player.entre_speaker
        media_content_id: !secret content_silence_mp3
        media_content_type: music
    - delay: '00:00:03'
    - service: tts.google_say
      entity_id: media_player.entre_speaker
      data:
        message: 'Hemmaläge aktiverat!'

  gast_mode:
    sequence:
    - service: automation.trigger
      data: 
        entity_id: automation.gastlage
    - service: media_player.play_media
      data:
        entity_id: media_player.entre_speaker
        media_content_id: !secret content_silence_mp3
        media_content_type: music
    - delay: '00:00:03'
    - service: tts.google_say
      entity_id: media_player.entre_speaker
      data:
        message: 'Gästläge aktiverat!'        


  jul_mode:
    sequence:
    - service: automation.trigger
      data: 
        entity_id: automation.jul_mode
    - service: media_player.play_media
      data:
        entity_id: media_player.entre_speaker
        media_content_id: !secret content_silence_mp3
        media_content_type: music
    - delay: '00:00:03'
    - service: tts.google_say
      entity_id: media_player.entre_speaker
      data:
        message: 'Jul läge aktiverat!'

        
 #####RADIO###########     
      
  radio_p3:
    alias: Play Radio on Chromecast Audio
    sequence:
      - service: media_player.volume_set
        data_template:
          entity_id: >
           {% if is_state("input_select.chromecast_radio", "Entre") %} media_player.entre_speaker
           {% elif is_state("input_select.chromecast_radio", "Vardagsrum") %} media_player.livingroom_speaker
           {% elif is_state("input_select.chromecast_radio", "Köket") %} media_player.kitchen_speaker
           {% elif is_state("input_select.chromecast_radio", "Alla") %} media_player.hela_huset
           {% endif %}
          volume_level: '{{  states.input_number.volume_radio.state  }}'
      - service: media_player.volume_set
        entity_id:
        - media_player.entre_speaker
        - media_player.kitchen_speaker
        data:
          volume_level: 0.05
      - service: tts.google_say
        data_template:
          entity_id: >
           {% if is_state("input_select.chromecast_radio", "Entre") %} media_player.entre_speaker
           {% elif is_state("input_select.chromecast_radio", "Vardagsrum") %} media_player.livingroom_speaker
           {% elif is_state("input_select.chromecast_radio", "Köket") %} media_player.kitchen_speaker
           {% elif is_state("input_select.chromecast_radio", "Alla") %} media_player.hela_huset
           {% endif %}
          message: "Nästa: {{ states.input_select.radio_station.state  }}"
      - delay: '00:00:07'
      - service: media_player.play_media
        data_template:
          entity_id: >
           {% if is_state("input_select.chromecast_radio", "Entre") %} media_player.entre_speaker
           {% elif is_state("input_select.chromecast_radio", "Vardagsrum") %} media_player.livingroom_speaker
           {% elif is_state("input_select.chromecast_radio", "Köket") %} media_player.kitchen_speaker
           {% elif is_state("input_select.chromecast_radio", "Alla") %} media_player.hela_huset
           {% endif %}
          media_content_id: >
           {% if is_state("input_select.radio_station", "SR P3") %} http://sverigesradio.se/topsy/direkt/164-hi.mp3
           {% elif is_state("input_select.radio_station", "SR P4 Gävleborg") %} http://sverigesradio.se/topsy/direkt/210-hi.mp3
           {% elif is_state("input_select.radio_station", "Mix Megapol") %} http://tx-bauerse.sharp-stream.com/http_live.php?i=mixmegapol_instream_se_mp3
           {% elif is_state("input_select.radio_station", "NRJ") %} http://tx-bauerse.sharp-stream.com/http_live.php?i=nrj_instreamtest_se_mp3
           {% elif is_state("input_select.radio_station", "RockKlassiker") %} http://tx-bauerse.sharp-stream.com/http_live.php?i=rockklassiker_instream_se_mp3
           {% elif is_state("input_select.radio_station", "Vinyl FM") %} http://tx-bauerse.sharp-stream.com/http_live.php?i=vinylfm_instream_se_mp3
           {% elif is_state("input_select.radio_station", "Julradio P4") %} http://sverigesradio.se/topsy/direkt/3034-hi-mp3.mp3
           {% elif is_state("input_select.radio_station", "Julradio P4") %} http://sverigesradio.se/topsy/direkt/3036-hi-mp3.mp3
           {% endif %}
          media_content_type: 'audio/mp4'
          
########################
### FÖDELSEDAGAR TTS ###
########################

  evenice_fodelsedag:
    alias: Evenice födelsedag
    sequence:
      - service: media_player.volume_set
        entity_id:
          - media_player.entre_speaker
          - media_player.kitchen_speaker
        data:
          volume_level: 0.3
      - service: media_player.play_media
        data:
          entity_id:
            - media_player.entre_speaker
            - media_player.kitchen_speaker
          media_content_id: !secret content_silence_mp3
          media_content_type: music
      - delay: '00:00:05'
      - service: tts.google_say
        entity_id:
          - media_player.entre_speaker
          - media_player.kitchen_speaker
        data_template:
          message: >
            {% if now().strftime("%b") == "Jan" and now().strftime("%-d") == "4" %}
              {% set yearDiff = now().strftime("%Y") | int - 2014 %}
              {% set monthDiff = now().strftime("%m") | int - 01 %}
              {% set dayDiff = now().strftime("%d") | int - 05%}
              {% if dayDiff < 0 or monthDiff < 0 %}
                {% set age = yearDiff %}
              {% else %}
                {% set age = yearDiff %}
              {% endif %}
              Grattis idag fyller du {{ age }} år Lillis!
              {% endif %}
                   
  isabelles_fodelsedag:
    alias: Isabelles födelsedag
    sequence:
      - service: media_player.volume_set
        entity_id:
          - media_player.entre_speaker
          - media_player.kitchen_speaker
        data:
          volume_level: 0.3
      - service: media_player.play_media
        data:
          entity_id:
            - media_player.entre_speaker
            - media_player.kitchen_speaker
          media_content_id: !secret content_silence_mp3
          media_content_type: music
      - delay: '00:00:05'
      - service: tts.google_say
        entity_id:
          - media_player.entre_speaker
          - media_player.kitchen_speaker
        data_template:
          message: >
            {% if now().strftime("%b") == "Feb" and now().strftime("%-d") == "11"%}
              {% set yearDiff = now().strftime("%Y") | int - 1992 %}
              {% set monthDiff = now().strftime("%m") | int - 02 %}
              {% set dayDiff = now().strftime("%d") | int - 11 %}
              {% if dayDiff < 0 or monthDiff < 0 %}
                {% set age = yearDiff %}
              {% else %}
                {% set age = yearDiff %}
              {% endif %}
              Grattis idag fyller du {{ age }} år Isabelle!
              {% endif %}
              
  oskars_fodelsedag:
    alias: Oskars födelsedag
    sequence:
      - service: media_player.volume_set
        entity_id:
          - media_player.entre_speaker
          - media_player.kitchen_speaker
        data:
          volume_level: 0.3
      - service: media_player.play_media
        data:
          entity_id:
            - media_player.entre_speaker
            - media_player.kitchen_speaker
          media_content_id: !secret content_silence_mp3
          media_content_type: music
      - delay: '00:00:05'
      - service: tts.google_say
        entity_id:
          - media_player.entre_speaker
          - media_player.kitchen_speaker
        data_template:
          message: >
            {% if now().strftime("%b") == "Jun" and now().strftime("%-d") == "11"%}
              {% set yearDiff = now().strftime("%Y") | int - 1992 %}
              {% set monthDiff = now().strftime("%m") | int - 06 %}
              {% set dayDiff = now().strftime("%d") | int - 11 %}
              {% if dayDiff < 0 or monthDiff < 0 %}
                {% set age = yearDiff %}
              {% else %}
                {% set age = yearDiff %}
              {% endif %}
              Grattis idag fyller du {{ age }} år Oskar!
              {% endif %}
              
  theus_fodelsedag:
    alias: Theus födelsedag
    sequence:
      - service: media_player.volume_set
        entity_id:
          - media_player.entre_speaker
          - media_player.kitchen_speaker
        data:
          volume_level: 0.3
      - service: media_player.play_media
        data:
          entity_id:
            - media_player.entre_speaker
            - media_player.kitchen_speaker
          media_content_id: !secret content_silence_mp3
          media_content_type: music
      - delay: '00:00:05'
      - service: tts.google_say
        entity_id:
          - media_player.entre_speaker
          - media_player.kitchen_speaker
        data_template:
          message: >
            {% if now().strftime("%b") == "Sep" and now().strftime("%-d") == "02"%}
              {% set yearDiff = now().strftime("%Y") | int - 2014 %}
              {% set monthDiff = now().strftime("%m") | int - 09 %}
              {% set dayDiff = now().strftime("%d") | int - 02 %}
              {% if dayDiff < 0 or monthDiff < 0 %}
                {% set age = yearDiff %}
              {% else %}
                {% set age = yearDiff %}
              {% endif %}
              Grattis idag fyller du {{ age }} år Theus!
              {% endif %}
          
#  vardagsrum_on:
#    sequence:
#     - service: remote.send_command
#         entity_id: remote.vardagsrum
#       data:
#        device: "Musik"
#        command: "PowerOn"
#    - service: remote.send_command
#        entity_id: remote.vardagsrum
#      data:
#        device: "Musik"
#        command: "PowerOff"

#  vardagsrum_off:
#    sequence:
#     - service: remote.send_command
#         entity_id: remote.vardagsrum
#       data:
#        device: "37710632"
#        command: "PowerOn"


###############################
#### Välkomen hem "person" ####
###############################
  speech_processing:
    sequence:
      - service: media_player.volume_set
        entity_id:
          - media_player.entre_speaker
        data:
          volume_level: 0.3
      - service: media_player.play_media
        data_template:
          entity_id: '{{ media_player }}'
          media_content_id: !secret content_silence_mp3
          media_content_type: music
      - delay: '00:00:05'
      - service: tts.google_say
        data_template:
          entity_id: '{{ media_player }}'
          message: '{{ speech_message }}'
          cache: true

  speech_engine:
    sequence:
#      - condition: or
#        conditions:
#          - condition: state
#            entity_id: group.devices_adults
#            state: 'home'
      - service: script.speech_processing
        data_template:
          media_player: >-
              {% if media_player | length == 0 %}
                {% set media_player = [
                  'media_player.entre_speaker'
                ] %}
              {% endif %}
              {% if media_player is not string and media_player is sequence %}
                {% set media_player = media_player|join(', ') %}
              {% endif %}
              {{ media_player }}
          speech_message: '{{ personarriving }}'

####################################
#### Välkomen till oss "person" ####
####################################
  speech_processing_2:
    sequence:
      - service: media_player.volume_set
        entity_id:
          - media_player.entre_speaker
        data:
          volume_level: 0.3
      - service: media_player.play_media
        data_template:
          entity_id: '{{ media_player }}'
          media_content_id: !secret content_silence_mp3
          media_content_type: music
      - delay: '00:00:05'
      - service: tts.google_say
        data_template:
          entity_id: '{{ media_player }}'
          message: '{{ speech_message }}'
          cache: true

  speech_engine_2:
    sequence:
#      - condition: or
#        conditions:
#          - condition: state
#            entity_id: group.devices_adults
#            state: 'home'
      - service: script.speech_processing_2
        data_template:
          media_player: >-
              {% if media_player | length == 0 %}
                {% set media_player = [
                  'media_player.entre_speaker'
                ] %}
              {% endif %}
              {% if media_player is not string and media_player is sequence %}
                {% set media_player = media_player|join(', ') %}
              {% endif %}
              {{ media_player }}
          speech_message: '{{ personarriving }}'

  turn_off_media_player:
    sequence:
      - service: media_player.toggle
        entity_id: media_player.kitchen_speaker
      - service: media_player.toggle
        entity_id: media_player.entre_speaker
      - service: media_player.toggle
        entity_id: media_player.livingroom_speaker
      - service: media_player.toggle
        entity_id: media_player.hela_huset
      - service: media_player.toggle
        entity_id: media_player.nere

        
  pause_media_player:
    sequence:
      - service: media_player.media_pause
        entity_id: media_player.kitchen_speaker
      - service: media_player.media_pause
        entity_id: media_player.entre_speaker
      - service: media_player.media_pause
        entity_id: media_player.livingroom_speaker
      - service: media_player.media_pause
        entity_id: media_player.hela_huset
      - service: media_player.media_pause
        entity_id: media_player.nere

        
  play_media_player:
    sequence:
      - service: media_player.media_play
        entity_id: media_player.kitchen_speaker
      - service: media_player.media_play
        entity_id: media_player.entre_speaker
      - service: media_player.media_play
        entity_id: media_player.livingroom_speaker
      - service: media_player.media_play
        entity_id: media_player.hela_huset
      - service: media_player.media_play
        entity_id: media_player.nere

        
        
  ifttt_alarm_clock:
    sequence:
    - condition: state
      entity_id: 'group.devices_oskar'
      state: 'home'
    - service: light.turn_on
      data:
        entity_id: group.light_sovrummet
        brightness: 255
        transition: 600
#    - delay: '00:20:30'
#    - service: media_player.volume_set
#      entity_id:
#        - media_player.entre_speaker
#        - media_player.koket
#        - media_player.bedroom_mini
#      data:
#        volume_level: 0.15
#    - service: media_player.play_media
#      data:
#        entity_id:
#        - media_player.entre_speaker
#        media_content_id: !secret content_motivation_mp3
#        media_content_type: music
    

  alarm_arm:
    sequence:
      service: alarm_control_panel.alarm_arm_away
      entity_id: alarm_control_panel.kernehed_manison
  alarm_disarm:
    sequence:
      service: alarm_control_panel.alarm_disarm
      entity_id: alarm_control_panel.kernehed_manison
      data:
        code: 2923
        

  test_telegram:
    alias: 'test_telegram'
    sequence:
      - service: notify.adults
        data:
          title: TEST MESSAGE
          message: 'This is a test!'
          
          
## ALARM ##
  flash_lights:
    alias: Flash Lights
    sequence:
      - service: homeassistant.turn_on
        data:
          entity_id:
            - light.evenice_lampa
            - light.theus_lampa
          brightness: 255
          rgb_color: [255,0,0]
      - delay:
          seconds: 1
      - service: homeassistant.turn_on
        data:
          entity_id:
            - group.light_hallen
            - group.light_koket
          brightness: 255
      - delay:
          seconds: 1
      - service: homeassistant.turn_off
        data:
          entity_id:
            - light.evenice_lampa
            - light.theus_lampa
            - group.light_hallen
            - group.light_koket
      - service: script.turn_on
        data:
          entity_id: script.light_loop
  light_loop:
    alias: Light flash loop
    sequence:
      - delay:
          seconds: 1
      - service: script.turn_on
        data:
          entity_id: script.flash_lights
  light_loop_kill:
    alias: Kill flashing lights
    sequence:
      service: script.turn_off
      data:
        entity_id: script.light_loop
        
 
# SNAPSHOT

  entre_camera_snapshot:
    sequence:
    - service: camera.snapshot
      data:
        entity_id: camera.entre
        filename: '/config/snapshot/entre_camera.jpg'
    - service: notify.adults
      data:
        message: "Entré kameran har fångat rörelse, skickar bild:"
        title: "Entré kamera - bild:"
        data:
          photo:
            - file: '/config/snapshot/entre_camera.jpg'
              caption: Entré kamera
              
              
              
              
  dorrklockan_snapshot:
    sequence:
    - service: camera.snapshot
      data:
        entity_id: camera.entre
        filename: '/config/snapshot/dorrklockan.jpg'
    - service: notify.adults
      data:
        message: "Någon plingar på dörren"
        title: "Dörrklockan - bild:"
        data:
          photo:
            - file: '/config/snapshot/dorrklockan.jpg'
              caption: Dörrklockan
              
  dropbox_backup:
    alias: Backup HA Configuration To Dropbox
    sequence:
      - service: shell_command.dropbox_backup
      
  brasan:
    sequence:
    - service: media_extractor.play_media
      data:
        entity_id: media_player.livingroom
        media_content_id: https://www.youtube.com/watch?v=ZY3J3Y_OU0w
        media_content_type: video