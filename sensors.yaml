
  - platform: google_travel_time
    name: Oskar tid till hem
    api_key: !secret api_key_google_travel_time
    origin: device_tracker.google_maps_114170795730412573739
    destination: zone.home
    
  - platform: google_travel_time
    name: Bella tid till hem
    api_key: !secret api_key_google_travel_time
    origin: device_tracker.google_maps_103719873476746592925
    destination: zone.home
    options:
      mode: transit
    
  - platform: systemmonitor
    resources:
      - type: processor_use
      - type: memory_free
      - type: disk_free
        arg: /home
      - type: last_boot

 ##SÄTT PÅ NÄR DET ÄR JUL!!!
  - platform: rest
    name: brightness_rest
    resource: http://192.168.2.15/brightness
    method: GET
    
  - platform: rest
    name: palette_rest
    resource: http://192.168.2.15/palette
    method: GET

  - platform: qbittorrent
    url: !secret qbit_url
    username: !secret qbit_username
    password: !secret qbit_password

  - platform: yr
    name: Väder
    monitored_conditions:
      - temperature 
      
  - platform: pi_hole
    host: !secret pihole_host
    ssl: true
    verify_ssl: false
    monitored_conditions:
      - ads_blocked_today
      - dns_queries_today
      - unique_clients
      
  - platform: darksky
    api_key: !secret darksky_key
    monitored_conditions:
      - summary
      - icon
      - apparent_temperature
      - precip_probability
      - precip_intensity
      - wind_bearing
      - temperature
      - humidity
      - pressure
      - daily_summary
      - wind_speed
      
      
### SCRAPESENSOR MATSEDEL ###

# LILLHAGSSKOLAN
  - platform: scrape
    name: Lillhagsskolan lunch måndag
    resource: https://skolmaten.se/lillhagsskolan/
    select: 'div.row:nth-of-type(1) p:nth-of-type(2) span'
    scan_interval: 14400
   
  - platform: scrape
    name: Lillhagsskolan lunch tisdag
    resource: https://skolmaten.se/lillhagsskolan/
    select: 'div.row:nth-of-type(2) p:nth-of-type(2) span'
    scan_interval: 14400
   
  - platform: scrape
    name: Lillhagsskolan lunch onsdag
    resource: https://skolmaten.se/lillhagsskolan/
    select: 'div.row:nth-of-type(3) p:nth-of-type(2) span'
    scan_interval: 14400
   
  - platform: scrape
    name: Lillhagsskolan lunch torsdag
    resource: https://skolmaten.se/lillhagsskolan/
    select: 'div.row:nth-of-type(4) p:nth-of-type(2) span'
    scan_interval: 14400
   
  - platform: scrape
    name: Lillhagsskolan lunch fredag
    resource: https://skolmaten.se/lillhagsskolan/
    select: 'div.row:nth-of-type(5) p:nth-of-type(2) span'
    scan_interval: 14400

# STORHAGENSFÖRSKOLA

  - platform: scrape
    name: Storhagensförskola lunch måndag
    resource: https://skolmaten.se/storhagens-forskola2/
    select: 'div.row:nth-of-type(1) p:nth-of-type(2) span:nth-of-type(1)'
    scan_interval: 14400
   
  - platform: scrape
    name: Storhagensförskola lunch tisdag
    resource: https://skolmaten.se/storhagens-forskola2/
    select: 'div.row:nth-of-type(2) p:nth-of-type(2) span:nth-of-type(1)'
    scan_interval: 14400
   
  - platform: scrape
    name: Storhagensförskola lunch onsdag
    resource: https://skolmaten.se/storhagens-forskola2/
    select: 'div.row:nth-of-type(3) p:nth-of-type(2) span:nth-of-type(1)'
    scan_interval: 14400
   
  - platform: scrape
    name: Storhagensförskola lunch torsdag
    resource: https://skolmaten.se/storhagens-forskola2/
    select: 'div.row:nth-of-type(4) p:nth-of-type(2) span:nth-of-type(1)'
    scan_interval: 14400
   
  - platform: scrape
    name: Storhagensförskola lunch fredag
    resource: https://skolmaten.se/storhagens-forskola2/
    select: 'div.row:nth-of-type(5) p:nth-of-type(2) span:nth-of-type(1)'
    scan_interval: 14400
      
##################
##DOOR

  - platform: template
    sensors:
      zwave_battery_front_door:
        value_template: '{{ states.zwave.polycontrol_danalock_v3_btze.attributes.battery_level|default(0) }}'
        icon_template: >
          {% set battery_level = states.zwave.polycontrol_danalock_v3_btze.attributes.battery_level | default(0) | int %}
          {% set battery_round = (battery_level / 10) |int * 10 %}
          {% if battery_round >= 100 %}
            mdi:battery
          {% elif battery_round > 0 %}
            mdi:battery-{{ battery_round }}
          {% else %}
            mdi:battery-alert
          {% endif %}
        
       
#  - platform: mqtt
#    state_topic: "home/sparsnas"
#    name: "Energiförbrukning:"
#    unit_of_measurement: "W"
#    value_template: '{{ value_json.Watt | round(1) }}'
# Note that the sensor below will be resetted if you remove/reinstall the batteries in the Sparsnäs transmitter
#  - platform: mqtt
#    state_topic: "home/sparsnas"
#    name: "Energiförbrukning över tid:"
#    unit_of_measurement: "kWh"
#    value_template: '{{ value_json.kWh | round(1) }}'
#  - platform: mqtt
#    state_topic: "home/sparsnas"
#    name: "Batteri:"
#    unit_of_measurement: "%"
#    value_template: '{{ value_json.battery | round(1) }}'
#  - platform: mqtt
#    state_topic: "home/sparsnas"
#    name: "Sparsnäs Frequency Error"
#    unit_of_measurement: "%"
#    value_template: '{{ value_json.FreqErr }}'
#  - platform: mqtt
#    name: "Sparsnäs template kwh sensor day"
#    state_topic: "template/kwh/day"
#  - platform: mqtt
#    name: "Sparsnäs template kwh sensor month"
#    state_topic: "template/kwh/month"
#  - platform: template
#    sensors:
#      kwh_current_month:
#        friendly_name: "Förbrukning denna månad"
#        unit_of_measurement: "kWh"
#        value_template: >-
#          {{ (float(states.sensor.energiforbrukning_over_tid.state) - float(states.sensor.sparsnas_template_kwh_sensor_month.state)) | round(1) }}
#      kwh_today:
#        friendly_name: "Förbrukning idag"
#        unit_of_measurement: "kWh"
#        value_template: >-
#          {{ (float(states.sensor.energiforbrukning_over_tid.state) - float(states.sensor.sparsnas_template_kwh_sensor_day.state)) | round(1) }}
          

#  - platform: sql
#    db_url: sqlite:////config/home-assistant_v2.db
#    queries:
#      - name: DB size
#        query: 'SELECT table_schema "database", Round(Sum(data_length + index_length) / 1024, 1) "value" FROM information_schema.tables WHERE table_schema="homeassistant" GROUP BY table_schema;'
#        column: 'value'
#        unit_of_measurement: MB

  - platform: command_line
    name: DB size
    command: "du -m /config/home-assistant_v2.db | cut -f1"
    unit_of_measurement: 'MB'
    value_template: '{{ value | int - 1 }}'

  - platform: template
    sensors:
      oskar_devices:
        friendly_name: "Var är Oskar?"
        value_template: >-
          {%- set device_state1 = states('device_tracker.google_maps_114170795730412573739') -%}
          {%- set device_state2 = states('device_tracker.oneplus_6') -%}
          {%- set custom_state = {
            'work': 'Work',
            'Skolan': 'Skolan',
            'home': 'Hemma',
            'not_home': 'Ej hemma',
            'PEAK HQ': 'PEAK HQ',
            'GEAB': 'GEAB',
            'Mamma': 'Mamma',
            'away': 'Borta',
            'Bellas jobb': 'Bellas jobb'
          } -%}
          {% if custom_state[device_state1] != '' and device_state2 == 'not_home' %}
           {{custom_state[device_state1]}}
          {% else %}
           {{custom_state[device_state2]}}
          {% endif%}


  - platform: template
    sensors:
      bella_devices:
        friendly_name: "Var är Bella?"
        value_template: >-
          {%- set device_state1 = states('device_tracker.google_maps_103719873476746592925') -%}
          {%- set device_state2 = states('device_tracker.iphone_7') -%}
          {%- set custom_state = {
            'work': 'Work',
            'Skolan': 'Skolan',
            'home': 'Hemma',
            'not_home': 'Ej hemma',
            'PEAK HQ': 'PEAK HQ',
            'GEAB': 'GEAB',
            'Mamma': 'Mamma',
            'away': 'Borta',
            'Bellas jobb': 'Bellas jobb'
          } -%}
          {% if custom_state[device_state1] != '' and device_state2 == 'not_home' %}
           {{custom_state[device_state1]}}
          {% else %}
           {{custom_state[device_state2]}}
          {% endif%}


  - platform: template
    sensors:
      oskar_bluetooth:
        friendly_name: "oskar bluetooth"
        value_template: "{% set map = {'Sovrummets Google Home': 'Sovrummet', 'Källare mini': 'Källaren', 'Evenice mini': 'Evenice rum','Vardagsrums Google Home': 'Vardagsrummet','Kökets Google Home': 'Köket','Theus mini': 'Theus rum','not_home': 'Ej hemma','Okänd': 'Ej tillgänglig'} %}{{ map[state_attr('device_tracker.64a2f984d997', 'ghunit')] }}"

  - platform: template
    sensors:
      bella_bluetooth:
        friendly_name: "bella bluetooth"
        value_template: "{% set map = {'Sovrummets Google Home': 'Sovrummet', 'Källare mini': 'Källaren', 'Evenice mini': 'Evenice rum','Vardagsrums Google Home': 'Vardagsrummet','Kökets Google Home': 'Köket','Theus mini': 'Theus rum','not_home': 'Ej hemma','Okänd': 'Ej tillgänglig'} %}{{ map[state_attr('device_tracker.f099b61b8446', 'ghunit')] }}"

  - platform: pollenkoll
    sensors:
      - city: Gävle
        state: Al
       
       
  - platform: template
    sensors:
      pollen_gras:
        friendly_name: "Pollen: gräs"
        value_template: >-
          {% if is_state_attr('sensor.pollenkoll_gavle', 'Gräs', 'i.h.') -%}
            Inga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Gräs', 'L') -%}
            Låga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Gräs', 'L-M') -%}
            Låga-måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Gräs', 'M') -%}
            Måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Gräs', 'M-H') -%}
            Måttliga-Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Gräs', 'H') -%}
            Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Gräs', 'H-H+') -%}
            Mycket höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Gräs', 'i.u.') -%}
            Inget
          {%- endif %}
      pollen_hassel:
        friendly_name: "Pollen: hassel"
        value_template: >-
          {% if is_state_attr('sensor.pollenkoll_gavle', 'Hassel', 'i.h.') -%}
            Inga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Hassel', 'L') -%}
            Låga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Hassel', 'L-M') -%}
           Låga-måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Hassel', 'M') -%}
            Måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Hassel', 'M-H') -%}
            Måttliga-Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Hassel', 'H') -%}
            Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Hassel', 'H-H+') -%}
            Mycket höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Hassel', 'i.u.') -%}
            Inget
          {%- endif %}
      pollen_al:
        friendly_name: "Pollen: al"
        value_template: >-
          {% if is_state_attr('sensor.pollenkoll_gavle', 'Al', 'i.h.') -%}
            Inga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Al', 'L') -%}
            Låga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Al', 'L-M') -%}
            Låga-måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Al', 'M') -%}
            Måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Al', 'M-H') -%}
            Måttliga-Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Al', 'H') -%}
            Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Al', 'H-H+') -%}
            Mycket höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Al', 'i.u.') -%}
            Inget
          {%- endif %}
      pollen_salg_vide:
        friendly_name: "Pollen: sälg /vide"
        value_template: >-
          {% if is_state_attr('sensor.pollenkoll_gavle', 'Sälg / vide', 'i.h.') -%}
            Inga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Sälg / vide', 'L') -%}
            Låga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Sälg / vide', 'L-M') -%}
            Låga-måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Sälg / vide', 'M') -%}
            Måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Sälg / vide', 'M-H') -%}
            Måttliga-Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Sälg / vide', 'H') -%}
            Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Sälg / vide', 'H-H+') -%}
            Mycket höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Sälg / vide', 'i.u.') -%}
            Inget
          {%- endif %}
      pollen_grabo:
        friendly_name: "Pollen: grabo"
        value_template: >-
          {% if is_state_attr('sensor.pollenkoll_gavle', 'Gråbo', 'i.h.') -%}
            Inga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Gråbo', 'L') -%}
            Låga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Gråbo', 'L-M') -%}
            Låga-måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Gråbo', 'M') -%}
            Måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Gråbo', 'M-H') -%}
            Måttliga-Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Gråbo', 'H') -%}
            Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Gråbo', 'H-H+') -%}
            Mycket höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Gråbo', 'i.u.') -%}
            Inget
          {%- endif %}
      pollen_bok:
        friendly_name: "Pollen: bok"
        value_template: >-
          {% if is_state_attr('sensor.pollenkoll_gavle', 'Bok', 'i.h.') -%}
            Inga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Bok', 'L') -%}
            Låga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Bok', 'L-M') -%}
            Låga-måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Bok', 'M') -%}
            Måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Bok', 'M-H') -%}
            Måttliga-Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Bok', 'H') -%}
            Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Bok', 'H-H+') -%}
            Mycket höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Bok', 'i.u.') -%}
            Inget
          {%- endif %}
      pollen_alm:
        friendly_name: "Pollen: alm"
        value_template: >-
          {% if is_state_attr('sensor.pollenkoll_gavle', 'Alm', 'i.h.') -%}
            Inga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Alm', 'L') -%}
            Låga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Alm', 'L-M') -%}
            Låga-måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Alm', 'M') -%}
            Måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Alm', 'M-H') -%}
            Måttliga-Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Alm', 'H') -%}
            Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Alm', 'H-H+') -%}
            Mycket höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Alm', 'i.u.') -%}
            Inget
          {%- endif %}
      pollen_bjork:
        friendly_name: "Pollen: björk"
        value_template: >-
          {% if is_state_attr('sensor.pollenkoll_gavle', 'Björk', 'i.h.') -%}
            Inga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Björk', 'L') -%}
            Låga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Björk', 'L-M') -%}
            Låga-måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Björk', 'M') -%}
            Måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Björk', 'M-H') -%}
            Måttliga-Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Björk', 'H') -%}
            Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Björk', 'H-H+') -%}
            Mycket höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Björk', 'i.u.') -%}
            Inget
          {%- endif %}
      pollen_ek:
        friendly_name: "Pollen: ek"
        value_template: >-
          {% if is_state_attr('sensor.pollenkoll_gavle', 'Ek', 'i.h.') -%}
            Inga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Ek', 'L') -%}
            Låga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Ek', 'L-M') -%}
            Låga-måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Ek', 'M') -%}
            Måttliga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Ek', 'M-H') -%}
            Måttliga-Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Ek', 'H') -%}
            Höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Ek', 'H-H+') -%}
            Mycket höga halter
          {%- elif is_state_attr('sensor.pollenkoll_gavle', 'Ek', 'i.u.') -%}
            Inget
          {%- endif %}
          

  - platform: time_date
    display_options:
      - 'time'
      - 'date'
      - 'date_time'
      - 'time_date'
      - 'time_utc'
      - 'beat'
      

  - platform: plex
    host: !secret plex_ip
    port: 32400
    name: Plex
    username: !secret plex_username
    password: !secret plex_password
    server: Plex Server
    token: !secret plex_token


  - platform: speedtest
    minute:
      - 0
      - 59
    monitored_conditions:
      - ping
      - download
      - upload
    
  - platform: template
    sensors:
      battery_oskar:
        friendly_name: oskar batteri
        unit_of_measurement: '%'
        value_template: >-
            {%- if states.device_tracker.google_maps_114170795730412573739.attributes.battery_level %}
                {{ states.device_tracker.google_maps_114170795730412573739.attributes.battery_level|round }}
            {% else %}
                {{ states.sensor.battery_oskar.state }}
            {%- endif %}
        device_class: battery

  - platform: template
    sensors:
      battery_bella:
        friendly_name: bella batteri
        unit_of_measurement: '%'
        value_template: >-
            {%- if states.device_tracker.google_maps_103719873476746592925.attributes.battery_level %}
                {{ states.device_tracker.google_maps_103719873476746592925.attributes.battery_level|round }}
            {% else %}
                {{ states.sensor.battery_bella.state }}
            {%- endif %}
        device_class: battery
        
  - platform: feedparser
    name: Engineering Feed
    feed_url: 'https://mikrotik.com/download.rss'
    date_format: '%a, %b %d %I:%M %p'
    inclusions:
      - title
      - link
    exclusions:
      - language

#  - platform: feedparser
#    name: Quote of the Day
#    feed_url: 'https://www.brainyquote.com/link/quotebr.rss'
#    date_format: '%a, %b %d %I:%M %p'

  - platform: template
    sensors:
      next_router_os_release:
        value_template: >
          {% set sorted_releases = states.sensor.engineering_feed.attributes | sort | reverse %}
          {%- for release in sorted_releases if release | regex_match('.*\[Stable\].*') %}
            {%- if loop.first %}
              {{- release | replace('[Stable]','') }}
            {%- endif %}
          {%- endfor %}
        friendly_name: Senaste mjukvaran
          
  - platform: snmp
    host: 192.168.2.1
    baseoid: 1.3.6.1.4.1.14988.1.1.4.4.0
    name: Installerad RouterOS

  - platform: snmp
    host: 192.168.2.1
    baseoid: 1.3.6.1.2.1.1.3.0
    name: Uptime

  - platform: snmp
    host: 192.168.1.1
    baseoid: 1.3.6.1.2.1.1.3.0
    name: Uptime server

  - platform: snmp
    host: 192.168.1.1
    baseoid: 1.3.6.1.4.1.14988.1.1.4.4.0
    name: Installerad RouterOS Server

  - platform: snmp
    host: 192.168.2.3
    baseoid: 1.3.6.1.2.1.1.3.0
    name: Uptime AP2

  - platform: snmp
    host: 192.168.2.2
    baseoid: 1.3.6.1.2.1.1.3.0
    name: Uptime AP1

  - platform: snmp
    host: 192.168.2.2
    baseoid: 1.3.6.1.4.1.41112.1.6.1.2.1.8.1
    name: Clients AP1

  - platform: snmp
    host: 192.168.2.2
    baseoid: 1.3.6.1.4.1.41112.1.6.1.2.1.8.3
    name: Clients AP1 5ghz


  - platform: snmp
    host: 192.168.2.3
    baseoid: 1.3.6.1.4.1.41112.1.6.1.2.1.8.1
    name: Clients AP2

  - platform: snmp
    host: 192.168.2.3
    baseoid: 1.3.6.1.4.1.41112.1.6.1.2.1.8.3
    name: Clients AP2 5ghz
    

  - platform: template
    sensors: 
      uptime_router:
        value_template: >
         {% set time = states.sensor.uptime.state | int %}
         {% set minutes = ((time % 360000) / 6000) | int%}
         {% set hours = ((time % 8640000) / 360000) | int %}
         {% set days = (time / 8640000) | int %}
         {%- if time < 6000 -%}
          Less than a minute
         {%- else -%}
         {%- if days > 0 -%}
          {%- if days == 1 -%}
            1d
          {%- else -%}
            {{ days }}d 
          {%- endif -%}
         {%- endif -%}
         {%- if hours > 0 -%}
          {%- if days > 0 -%}
          {%- endif -%}
          {%- if hours == 1 -%}
            1h
          {%- else -%}
            {{ hours }}h 
          {%- endif -%}
         {%- endif -%}
         {%- if minutes > 0 -%}
           {%- if days > 0 or hours > 0 -%}
          {%- endif -%}
          {%- if minutes == 1 -%}
            1m
          {%- else -%}
            {{ minutes }}m 
          {%- endif -%}
         {%- endif -%}
         {%- endif -%}
        friendly_name: Uptime
        
        
  - platform: template
    sensors: 
      uptime_router_server:
        value_template: >
         {% set time = states.sensor.uptime_server.state | int %}
         {% set minutes = ((time % 360000) / 6000) | int%}
         {% set hours = ((time % 8640000) / 360000) | int %}
         {% set days = (time / 8640000) | int %}
         {%- if time < 6000 -%}
          Less than a minute
         {%- else -%}
         {%- if days > 0 -%}
          {%- if days == 1 -%}
            1d
          {%- else -%}
            {{ days }}d 
          {%- endif -%}
         {%- endif -%}
         {%- if hours > 0 -%}
          {%- if days > 0 -%}
          {%- endif -%}
          {%- if hours == 1 -%}
            1h
          {%- else -%}
            {{ hours }}h 
          {%- endif -%}
         {%- endif -%}
         {%- if minutes > 0 -%}
           {%- if days > 0 or hours > 0 -%}
          {%- endif -%}
          {%- if minutes == 1 -%}
            1m
          {%- else -%}
            {{ minutes }}m 
          {%- endif -%}
         {%- endif -%}
         {%- endif -%}
        friendly_name: Uptime
        
  - platform: template
    sensors: 
      uptime_ap_1:
        value_template: >
         {% set time = states.sensor.uptime_ap1.state | int %}
         {% set minutes = ((time % 360000) / 6000) | int%}
         {% set hours = ((time % 8640000) / 360000) | int %}
         {% set days = (time / 8640000) | int %}
         {%- if time < 6000 -%}
          Less than a minute
         {%- else -%}
         {%- if days > 0 -%}
          {%- if days == 1 -%}
            1d
          {%- else -%}
            {{ days }}d 
          {%- endif -%}
         {%- endif -%}
         {%- if hours > 0 -%}
          {%- if days > 0 -%}
          {%- endif -%}
          {%- if hours == 1 -%}
            1h
          {%- else -%}
            {{ hours }}h 
          {%- endif -%}
         {%- endif -%}
         {%- if minutes > 0 -%}
           {%- if days > 0 or hours > 0 -%}
          {%- endif -%}
          {%- if minutes == 1 -%}
            1m
          {%- else -%}
            {{ minutes }}m 
          {%- endif -%}
         {%- endif -%}
         {%- endif -%}
        friendly_name: Uptime
        
  - platform: template
    sensors: 
      uptime_ap_2:
        value_template: >
         {% set time = states.sensor.uptime_ap2.state | int %}
         {% set minutes = ((time % 360000) / 6000) | int%}
         {% set hours = ((time % 8640000) / 360000) | int %}
         {% set days = (time / 8640000) | int %}
         {%- if time < 6000 -%}
          Less than a minute
         {%- else -%}
         {%- if days > 0 -%}
          {%- if days == 1 -%}
            1d
          {%- else -%}
            {{ days }}d 
          {%- endif -%}
         {%- endif -%}
         {%- if hours > 0 -%}
          {%- if days > 0 -%}
          {%- endif -%}
          {%- if hours == 1 -%}
            1h
          {%- else -%}
            {{ hours }}h 
          {%- endif -%}
         {%- endif -%}
         {%- if minutes > 0 -%}
           {%- if days > 0 or hours > 0 -%}
          {%- endif -%}
          {%- if minutes == 1 -%}
            1m
          {%- else -%}
            {{ minutes }}m 
          {%- endif -%}
         {%- endif -%}
         {%- endif -%}
        friendly_name: Uptime
        
  - platform: template
    sensors: 
      total_clients_wireless:
        value_template: >
         {{ states.sensor.clients_ap2.state | int + states.sensor.clients_ap2_5ghz.state | int + states.sensor.clients_ap1.state | int + states.sensor.clients_ap1_5ghz.state| int}}
        friendly_name: Total clients
        
 
  - platform: plex_recently_added
    token: Bq5p61wM5N69uDrcw9hn
    server_name: Plex Server
    ssl: true
    ssl_cert: false
    download_images: false
    max: 5


  - platform: krisinformation
    name: Krisinformation Gävle
    latitude: !secret home_lat
    longitude: !secret home_long
    radius: 100


  - platform: brottsplatskartan
    name: Händelser
    area: Gävleborgs län